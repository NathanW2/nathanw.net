---
layout: post
title: Generating chainage (distance) nodes in QGIS
tags:
- language python
- Open Source
- osgeo
- pyqgis
- python
- qgis
- qgis-tips
- Quantum GIS
- tips
status: publish
type: post
published: true
meta:
  superawesome: 'false'
  _edit_last: '4008903'
  jabber_published: '1344159365'
  _wpas_done_twitter: '1'
  email_notification: '1344159367'
  _wpas_mess: Generating chainage (distance) nodes in QGIS http://wp.me/pjIwZ-hB
  tagazine-media: a:7:{s:7:"primary";s:53:"http://woostuff.files.wordpress.com/2012/08/nodes.png";s:6:"images";a:1:{s:53:"http://woostuff.files.wordpress.com/2012/08/nodes.png";a:6:{s:8:"file_url";s:53:"http://woostuff.files.wordpress.com/2012/08/nodes.png";s:5:"width";i:701;s:6:"height";i:550;s:4:"type";s:5:"image";s:4:"area";i:385550;s:9:"file_path";b:0;}}s:6:"videos";a:0:{}s:11:"image_count";i:1;s:6:"author";s:7:"4008903";s:7:"blog_id";s:7:"4699413";s:9:"mod_stamp";s:19:"2012-08-05
    09:36:01";}
---
Something that I need to do now and then is generate points along a line at&nbsp;supplied&nbsp;distance. &nbsp;I had never really looked into doing it in QGIS until <a href="http://gis.stackexchange.com/questions/27102/how-to-create-equidistant-points-in-qgis">this</a> question poped up on <a href="gis.stackexchange.com">gis.stackexchange.com</a>. &nbsp;This is a quick blog post because I thought it was a pretty handy little thing to do.

In the development version there is a new method on <code>QgsGeometry</code> called <code>interpolate</code>. This method takes a distance and returns a point along a line at that distance. Perfect! We can then just wrap this in a loop and generate a point increasing the distance as we move along

[sourcecode language="python"]
from qgis.core import (QgsFeature, QgsGeometry,
                       QgsVectorLayer, QgsMapLayerRegistry,
                       QgsField)
from PyQt4.QtCore import QVariant
from qgis.utils import iface

def createPointsAt(distance, geom):
    length = geom.length()
    currentdistance = distance
    feats = []

    while currentdistance &lt; length:
        # Get a point along the line at the current distance
        point = geom.interpolate(currentdistance)
        # Create a new QgsFeature and assign it the new geometry
        fet = QgsFeature()
        fet.setAttributeMap( { 0 : currentdistance } )
        fet.setGeometry(point)
        feats.append(fet)
        # Increase the distance
        currentdistance = currentdistance + distance

    return feats

def pointsAlongLine(distance):
    # Create a new memory layer and add a distance attribute
    vl = QgsVectorLayer(&quot;Point&quot;, &quot;distance nodes&quot;, &quot;memory&quot;)
    pr = vl.dataProvider()
    pr.addAttributes( [ QgsField(&quot;distance&quot;, QVariant.Int) ] )
    layer = iface.mapCanvas().currentLayer()
    # Loop though all the selected features
    for feature in layer.selectedFeatures():
        geom = feature.geometry()
        features = createPointsAt(distance, geom)
        pr.addFeatures(features)
        vl.updateExtents()

    QgsMapLayerRegistry.instance().addMapLayer(vl)
[/sourcecode]

The above code might look a bit scary at first if you have never done any Python/pyqgis but hopefully the comments will ease the pain a little. The main bit is the <code>createPointsAt</code> function.

Cool! If we want to use this we can just stick it in a file in the <code>.qgis/python</code> folder (lets call it pointtools.py) and then run <code>import pointtools</code> in the python console.

So lets have a go. First select some objects then run the following in the Python Console

[sourcecode language="python"]
import pointtools
pointtools.pointsAlongLine(40)
[/sourcecode]

That will generate a point every 40 meters along then selected lines

[caption id="attachment_1093" align="aligncenter" width="630"]<a href="http://woostuff.files.wordpress.com/2012/08/nodes.png"><img class="size-full wp-image-1093" title="nodes" src="http://woostuff.files.wordpress.com/2012/08/nodes.png" alt="" width="630" height="494" /></a> Distance nodes along line in qgis-dev[/caption]

To generate nodes along different lines, select the new features, then call <code>pointtools.pointsAlongLine(40)</code> in the Python console.

Simple as that!

(Who knows, someone (maybe me) might even add this as a core object function in QGIS in the future)
