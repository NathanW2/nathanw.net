---
layout: post
title: Creating an instance of a Mapinfo COM object in .NET - Part One
tags:
- .NET
- Mapbasic
- mapinfo
- mapinfo interop
- mapinfo ole
- Mapinfo Programming
- mapping
status: publish
type: post
published: true
meta:
  _edit_last: '4008903'
  reddit: a:2:{s:5:"count";s:1:"0";s:4:"time";s:10:"1335409395";}
---
This the first blog post in the series <a href="http://woostuff.wordpress.com/2009/04/01/com-instance-mapinfo-main/" target="_blank">Creating a instance of a Mapinfo COM object in .NET.</a>

In this post I am going to talk about <strong>creating an instance of using Interop.Mapinfo.dll. </strong>So lets get into it.
<h2>Step 1: Adding a referance to Mapinfo.</h2>
First we need to add a reference to Mapinfo's COM object, this can be done in a few different ways, for now I will just focus on the main method.

You will need to open the add reference dialog in Visual Studio and select the COM tab, this should give you a list of all the COM objects that have been registered on your machine.  You will need to select the one marked "Mapinfo x.x OLE Automation" where x.x is the version of the currently installed Mapinfo.  For example:

<img class="size-full wp-image-69 alignleft" title="COM Dialog" src="http://woostuff.files.wordpress.com/2009/03/ref.jpg" alt="COM Dialog" width="327" height="273" />

 

 

 

 

 

 

 
<p style="text-align:left;"> </p>
<p style="text-align:left;"> </p>
<p style="text-align:left;">Once you have found and selected the Mapinfo COM object, you can then click OK.  When you return to Visual Studio you will notice that a referance to Mapinfo has been added to your project. </p>

<img class="size-full wp-image-70 alignleft" title="referance added" src="http://woostuff.files.wordpress.com/2009/03/mapref.jpg" alt="referance added" width="157" height="70" />

 

 

 

By checking the object browser, you will notice that by adding a reference to Mapinfo's COM object, we now have strong typed access to its members.

<img class="alignleft size-full wp-image-76" title="objects1" src="http://woostuff.files.wordpress.com/2009/03/objects1.jpg" alt="objects1" width="468" height="664" />
<p style="text-align:left;"> </p>
<p style="text-align:left;"> </p>
<p style="text-align:left;"> </p>
<p style="text-align:left;"> </p>
<p style="text-align:left;"> </p>
<p style="text-align:left;"> </p>
<p style="text-align:left;"> </p>
<p style="text-align:left;"> </p>
<p style="text-align:left;"> </p>
<p style="text-align:left;"> </p>
<p style="text-align:left;"> </p>
<p style="text-align:left;"> </p>
<p style="text-align:left;"> </p>
<p style="text-align:left;"> </p>
<p style="text-align:left;"> </p>
<p style="text-align:left;"> </p>
<p style="text-align:left;"> </p>
<p style="text-align:left;"> </p>
<p style="text-align:left;"> </p>
<p style="text-align:left;"> </p>
<p style="text-align:left;"> </p>
<p style="text-align:left;">(Note: Picture may differ slightly to other versions of Mapinfo).</p>
<p style="text-align:left;">We now have strongly typed access to Mapinfo's COM methods. When we add a reference to a COM object using Visual Studio it will create a dll in the form of a <a href="http://msdn.microsoft.com/en-us/library/8bwh56xe.aspx">RCW(Runtime Callable Wrapper).</a> This then wraps all the exposed COM members into .NET objects which are responsible for marshaling all the calls between your .NET application and the COM object, including any type conversion that needs to be preformed. </p>
<p style="text-align:left;">Now that we have got all of that out of the way lets move on to step 2.</p>

<h2>Step 2: Creating the instance</h2>
When you are using the Interop.Mapinfo.dll, creating an instance of the currently installed Mapinfo is very easy.
In the picture above you can see a class called <em>MapInfoApplicationClass, </em>this is the object we will be using to create an instance of Mapinfo.  Having said that, all we need to do is create a new <em>MapinfoApplicationClass </em>like this:

[sourcecode language='csharp']
MapInfo.MapInfoApplicationClass mapinfo = new MapInfo.MapInfoApplicationClass();
[/sourcecode]

When this line is executed in your program  a new instance of  Mapinfo will be created and you will then be able to send commands to it by using the <em>Do</em> and <em>Eval </em>command. Like so:

[sourcecode language='csharp']
MapInfo.MapInfoApplicationClass mapinfo = new MapInfo.MapInfoApplicationClass();
mapinfo.Do("Do somthing here");
string value = mapinfo.Eval("Eval something here");
[/sourcecode]
<p style="text-align:left;">Nice and easy!</p>
<p style="text-align:left;">So you compile your application and it runs and does what it has to do. Then a few months down the track you upgrade your version of Mapinfo and BOOM!, your application suddenly doesn't work any more.  Why does it not work anymore?</p>

<h2>Step 3: Finding the reason for not working with different versions.</h2>
<p style="text-align:left;">If you go to the defintion of <em>MapInfoApplicationClass</em> in Visual Studio you will notice something like this:</p>
<p style="text-align:left;"><img class="alignleft size-full wp-image-96" title="def" src="http://woostuff.files.wordpress.com/2009/03/def.jpg" alt="def" width="520" height="58" /></p>
<p style="text-align:left;">Whats with that GUID?  Turns out that is the ID for the registered Mapinfo COM object, and each version of Mapinfo has a different GUID.</p>

<ul>
	<li>v9.5 GUID = {D66B3D9C-D465-46B8-BFB4-F63F04FB203C}</li>
	<li>v8.5 GUID = {BA2638EB-CB99-4908-9915-771E04BBB7D3}</li>
</ul>
<p style="text-align:left;">So why does your application blow up when you upgrade the version of Mapinfo or run it on different machine with a different version of Mapinfo?  Well lets have a look at the Mapinfo RCW.  </p>
<p style="text-align:left;">When you create a Mapinfo RCW (Interop.Mapinfo.dll) using Visual Studio it will create a <em>MapInfoApplicationClass </em>with the GUID attribute which matches the COM objects and when you call the constructor of <em>MapInfoApplicationClass</em> it will look at all the registered COM objects on the computer to see if there is one with that GUID and if it finds one it will create an instance of it. </p>

<h2>Summing up: Pros and Cons</h2>
In summng up, lets have a look at some of the pros and cons of this approch, most of which I'm sure you have already picked up on.

<strong><em>Pros</em></strong>
<ul>
	<li>Allows strong typed access to members</li>
	<li>Allows early binding to take place which will let the compiler check for errors.</li>
	<li>Fast runtime access to methods due to early binding.</li>
</ul>
<strong><em>Cons</em></strong>
<ul>
	<li>Tied to the version of Mapinfo that was used when creating the RCW.</li>
</ul>
There maybe only one con but I believe that it is a pretty big one.  

On the plus side, if you are just creating a once off quick and dirty app, that will only be run once, then the above method will most likely be fine.
