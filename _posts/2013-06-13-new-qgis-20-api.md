---
layout: post
title: "New QGIS 2.0 API. What has changed and what it means for you"
description: ""
category: 
tags: []
---

QGIS 2.0 has under gone some radical changes for its upcoming release.  Some of these major changes relate to the API, both C++ and Python. Something that always comes up when trying to improve an API is the chance that you might have to remove the old way of doing something so that things are cleaner and improved for the future. These changes will always break existing working code and can be a burden for a little while until everything is adjusted. A little pain for a lot of gain is the way I like to think about it.  I will also add that breaking API so radically isn't something that we, as developers, like to do or take lightly, but sometimes it has to be done. 

This post is a summary of some of the new APIs, what has changed, and what to change in your code.

## New Vector API (Iterator pattern)

We would like to introduce multithreaded rendering in the future and the old API for getting a set of features from the provider wasn't going to cut it in a multithreaded environment.  In order to allow something that will be more threadable then the old select model we changed to a interator pattern.

The old used to look like this:

{% highlight python %}
layer.select()
for feature in layer:
	print feature
{% endhighlight %}

`select()` wouldn't return anything rather it would tell the provider of the layer to get ready to return some features when asked e.g the for loop. Want to thread that? Nope. Not going to happen.

### The solution:

Create a method that returns an iterator that each thread can loop over on their own without changing the result of the other.

{% highlight python %}
features = layer.getFeatures()
for feature in features:
	print feature
{% endhighlight %}

if you look at `layer.getFeatures()` you can see it returns a `QgsFeatureIterator`

{% highlight python %}
>>> layer.getFeatures()
<qgis.core.QgsFeatureIterator object at 0x1A05F810>
{% endhighlight %}

Sweet. `QgsFeatureIterator` has a next method which you can call to get the next feature, it will just serve them up as you need them.

{% highlight python %}
>>> features = layer.getFeatures()
>>> features.next()
<qgis.core.QgsFeature object at 0x1A062CD8>
>>> features.next()
<qgis.core.QgsFeature object at 0x1A062C48>
>>> features.next()
<qgis.core.QgsFeature object at 0x1A062C00>
>>> features.close()
{% endhighlight %}

So in the future (you can't do this yet due to some other restrictions):

{% highlight python %}
>>> features = layer.getFeatures()
>>> features2 = layer.getFeatures()
>>> features.next().id()
1L
>>> features.next().id()
2L
>>> features2.next().id()
1L
{% endhighlight %}

Nifty!

## New Vector API (Fields)